<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>christmas-tree</title>
  </head>
  <div id="photo-manager" style="
    position: fixed;
    top: 0;
    left: 0;
    height: 100%; /* å…¨å±é«˜åº¦ */
    width: 280px; /* å›ºå®šå®½åº¦ */
    background: rgba(0, 0, 0, 0.9);
    color: white;
    box-sizing: border-box;
    border-right: 2px solid #4CAF50;
    z-index: 9999;
    transition: transform 0.3s ease-in-out;
    transform: translateX(0); /* é»˜è®¤å±•å¼€çŠ¶æ€ */
    font-family: sans-serif;
    display: flex;
    flex-direction: column;">

    <div onclick="toggleManager()" title="åˆ‡æ¢æ˜¾ç¤º" style="
        position: absolute;
        right: -30px;
        top: 20px;
        width: 30px;
        height: 60px;
        background: #4CAF50;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        border-radius: 0 8px 8px 0;
        font-weight: bold;
        box-shadow: 3px 0 5px rgba(0,0,0,0.3);
        user-select: none;">
        <span id="toggle-icon">â—€</span>
    </div>

    <div style="
        padding: 20px;
        background: rgba(255, 255, 255, 0.1);
        border-bottom: 1px solid #444;">
        <h3 style="margin: 0; font-size: 18px; display: flex; align-items: center; gap: 8px;">
            ğŸ“¸ å›¾ç‰‡ç®¡ç†
        </h3>
        <small style="color: #aaa; font-size: 12px; margin-top: 5px; display: block;">ç®¡ç† photo æ–‡ä»¶å¤¹</small>
    </div>

    <div id="manager-content" style="
        padding: 20px;
        flex: 1; /* å æ»¡å‰©ä½™é«˜åº¦ */
        overflow-y: auto;">

        <div style="margin-bottom: 20px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;">
            <label style="display: block; margin-bottom: 8px; font-size: 14px;">ä¸Šä¼ æ–°å›¾:</label>
            <input type="file" id="fileInput" accept="image/*" style="color: white; font-size: 12px; width: 100%; margin-bottom: 10px;">
            <button onclick="uploadPhoto()" style="
                width: 100%;
                padding: 8px;
                cursor: pointer;
                background: #4CAF50;
                color: white;
                border: none;
                border-radius: 4px;
                font-weight: bold;">ç¡®è®¤ä¸Šä¼ </button>
        </div>

        <h4 style="margin: 0 0 10px 0; border-bottom: 1px solid #444; padding-bottom: 5px;">ç°æœ‰å›¾ç‰‡åˆ—è¡¨</h4>
        <div id="photo-list" style="display: flex; flex-direction: column; gap: 10px;">
            </div>
    </div>
</div>

<script>
    // const API_BASE = `http://${window.location.hostname}:3000`;
    let isExpanded = true;

    // é¡µé¢åŠ è½½æ—¶è·å–å›¾ç‰‡åˆ—è¡¨
    document.addEventListener('DOMContentLoaded', loadPhotos);

    // === æ”¶ç¼©/å±•å¼€ åˆ‡æ¢å‡½æ•° ===
    function toggleManager() {
        const panel = document.getElementById('photo-manager');
        const icon = document.getElementById('toggle-icon');

        if (isExpanded) {
            // æ”¶èµ·ï¼šå‘å·¦ç§»å‡ºå±å¹•
            panel.style.transform = 'translateX(-100%)';
            icon.innerText = 'â–¶'; // ç®­å¤´å‘å³ï¼Œæç¤ºå¯å±•å¼€
        } else {
            // å±•å¼€ï¼šæ¢å¤ä½ç½®
            panel.style.transform = 'translateX(0)';
            icon.innerText = 'â—€'; // ç®­å¤´å‘å·¦
        }
        isExpanded = !isExpanded;
    }

    // === åŠ è½½å›¾ç‰‡åˆ—è¡¨ ===
    function loadPhotos() {
        fetch('/api/photos')
            .then(res => res.json())
            .then(files => {
                const list = document.getElementById('photo-list');
                list.innerHTML = '';

                if(files.length === 0) {
                    list.innerHTML = '<p style="color:#aaa; text-align:center;">æš‚æ— å›¾ç‰‡</p>';
                    return;
                }

                files.forEach(file => {
                    // åˆ›å»ºåˆ—è¡¨é¡¹å®¹å™¨
                    const item = document.createElement('div');
                    item.style.display = 'flex';
                    item.style.alignItems = 'center';
                    item.style.gap = '10px';
                    item.style.backgroundColor = 'rgba(255,255,255,0.05)';
                    item.style.padding = '8px';
                    item.style.borderRadius = '6px';

                    // å›¾ç‰‡é¢„è§ˆ
                    const img = document.createElement('img');
                    img.src = '/thumbnails/' + file;
                    img.onerror = function() {
                        this.src = '/photos/' + file; // å¦‚æœç¼©ç•¥å›¾ä¸å­˜åœ¨ï¼Œå›é€€æ˜¾ç¤ºåŸå›¾
                    }
                    img.style.width = '50px';
                    img.style.height = '50px';
                    img.style.objectFit = 'cover';
                    img.style.borderRadius = '4px';
                    img.style.border = '1px solid #555';

                    // æ–‡ä»¶åå’Œåˆ é™¤æŒ‰é’®å®¹å™¨
                    const infoDiv = document.createElement('div');
                    infoDiv.style.flex = '1';
                    infoDiv.style.overflow = 'hidden';

                    // æ–‡ä»¶å
                    const name = document.createElement('div');
                    name.innerText = file;
                    name.title = file;
                    name.style.fontSize = '12px';
                    name.style.whiteSpace = 'nowrap';
                    name.style.overflow = 'hidden';
                    name.style.textOverflow = 'ellipsis';
                    name.style.marginBottom = '5px';

                    // åˆ é™¤æŒ‰é’®
                    const btn = document.createElement('button');
                    btn.innerText = 'åˆ é™¤';
                    btn.style.padding = '2px 8px';
                    btn.style.fontSize = '11px';
                    btn.style.backgroundColor = '#ff4444';
                    btn.style.color = 'white';
                    btn.style.border = 'none';
                    btn.style.cursor = 'pointer';
                    btn.style.borderRadius = '3px';
                    btn.onclick = () => deletePhoto(file);

                    infoDiv.appendChild(name);
                    infoDiv.appendChild(btn);

                    item.appendChild(img);
                    item.appendChild(infoDiv);
                    list.appendChild(item);
                });
            })
            .catch(err => console.error('åŠ è½½å›¾ç‰‡å¤±è´¥:', err));
    }

    // === ä¸Šä¼ å›¾ç‰‡ ===
    function uploadPhoto() {
        const input = document.getElementById('fileInput');
        if (input.files.length === 0) {
            alert('è¯·å…ˆé€‰æ‹©ä¸€å¼ å›¾ç‰‡ï¼');
            return;
        }

        const formData = new FormData();
        formData.append('image', input.files[0]);

        fetch('/api/upload', { method: 'POST', body: formData })
        .then(res => res.json())
        .then(data => {
            alert(data.message);
            input.value = '';
            loadPhotos();
        })
        .catch(err => alert('ä¸Šä¼ å‡ºé”™'));
    }

    // === åˆ é™¤å›¾ç‰‡ ===
    function deletePhoto(filename) {
        if(!confirm(`ç¡®å®šè¦åˆ é™¤ ${filename} å—?`)) return;

        fetch(`/api/photo/${filename}`, { method: 'DELETE' })
        .then(res => res.json())
        .then(data => {
            loadPhotos();
        })
        .catch(err => alert('åˆ é™¤å‡ºé”™'));
    }
</script>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
